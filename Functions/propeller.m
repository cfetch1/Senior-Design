function [Ct, Cp, thrust, power, eta] = propeller(rpm,V,h,temp,plotar)

% thrust - N
% power - hp
% V - m/s - TAS
% h - altitude - ft
% temp - F
% Ct - thrust coefficient - non dimensional
% Cp - power coefficient  - non dimensional
% Thrust - N
% Power (required to drive the propeller) - W
% eta - propeller efficiency 

D = 903.75*2/1000;
n = rpm/60;

% Unit conversion
V = V * 0.44704; %( mph to m/s)


%Density calculation
t_std = 288.15-6.5e-3*(h*0.3048);                                           % external temperature [K]
rho = ((1.048840 - 23.659414e-6*(h*0.3048))^4.2558797)/...                  % air density [kg/m3]
    (1+ ( ( (((temp-32)*5/9)+273.15) -t_std) /t_std) );

%v/(nD) v/(?R)	Ct          Cp          Cs          Tc          Pc          eta       eta*      stalled	v      
propeller_data = [
    
%MH112/MH114/MH114/MH120

% 0.000	0.000	0.132302	0.113342	0.000049	9.999999	9.999999	0.00	0.01	27.00 	0.00	
% 0.100	0.032	0.134514	0.110103	0.155468	9.999999	9.999999	12.22	28.33	50.00 	6.03	
% 0.200	0.064	0.133969	0.112218	0.309754	8.528745	9.999999	23.88	48.09	42.00 	12.05	
% 0.300	0.095	0.132129	0.114477	0.462783	3.738473	9.999999	34.63	61.88	27.00	18.08	
% 0.400	0.127	0.128988	0.116763	0.614609	2.052913	4.645861	44.19	71.59	18.00	24.10	
% 0.500	0.159	0.124774	0.119119	0.765198	1.270936	2.426678	52.37	78.49	9.00	30.13	
% 0.600	0.191	0.120300	0.118867	0.918627	0.850951	1.401353	60.72	83.41	9.00	36.15	
% 0.700	0.223	0.114770	0.114705	1.079398	0.596448	0.851584	70.04	87.05	9.00	42.17	
% 0.800	0.255	0.102595	0.110251	1.243408	0.408214	0.548342	74.45	90.25	11.00	48.20	
% 0.900	0.286	0.088044	0.101822	1.421262	0.276794	0.355676	77.82	92.83	1.00	54.23	
% 1.000	0.318	0.071006	0.090107	1.618261	0.180814	0.229455	78.80	94.97	4.00	60.25	
% 1.100	0.350	0.053815	0.075492	1.844221	0.113256	0.144431	78.42	96.64	4.00	66.28	
% 1.120	0.357	0.050327	0.072274	1.894184	0.102165	0.130998	77.99	96.94	4.00	67.48	
% 1.140	0.363	0.046088	0.069616	1.942511	0.090306	0.119655	75.47	97.26	7.00	68.69	
% 1.160	0.369	0.042539	0.066218	1.996471	0.080503	0.108029	74.52	97.53	7.00	69.89	
% 1.180	0.376	0.038968	0.062718	2.053072	0.071266	0.097204	73.32	97.79	7.00	71.10	
% 1.200	0.382	0.035376	0.059115	2.112718	0.062558	0.087115	71.81	98.03	7.00	72.30	
% 1.220	0.388	0.031766	0.055413	2.175896	0.054349	0.077709	69.94	98.27	7.00	73.51	
% 1.240	0.395	0.028139	0.051610	2.243235	0.046603	0.068930	67.61	98.50	7.00	74.71	
% 1.260	0.401	0.024486	0.047695	2.315664	0.039275	0.060716	64.69	98.72	7.00	75.92	
% 1.280	0.407	0.020825	0.043691	2.394038	0.032367	0.053052	61.01	98.94	7.00	77.12	
% 1.300	0.414	0.017190	0.039640	2.479230	0.025902	0.045946	56.38	99.14	7.00	78.33	
% 1.320	0.420	0.012557	0.036575	2.558213	0.018352	0.040495	45.32	99.38	10.00	79.53	
% 1.340	0.427	0.008806	0.032291	2.662489	0.012488	0.034175	36.54	99.58	10.00	80.74	
% 1.360	0.433	0.005031	0.027901	2.782371	0.006927	0.028245	24.52	99.76	10.00	81.94	
% 1.380	0.439	0.001233	0.023403	2.924326	0.001649	0.022676	7.27	99.94	10.00	83.15	
% 1.400	0.446	-0.002579	0.018809	3.099231	-0.003351	0.017455	0.00	99.99	10.00	84.35	
% 1.420	0.452	-0.006403	0.014123	3.328913	-0.008087	0.012560	0.00	99.99	10.00	85.56	
% 1.440	0.458	-0.010181	0.009430	3.659852	-0.012502	0.008042	0.00	99.99	10.00	86.76	
% 1.460	0.465	-0.013921	0.004723	4.261048	-0.016631	0.003864	0.00	99.99	10.00	87.97	
% 1.480	0.471	-0.017610	0.000032	11.720444	-0.020472	0.000025	0.00	99.99	10.00	89.17	
% 1.500	0.477	-0.022710	-0.003288	4.706439	-0.025702	-0.002481	0.25	50.58	14.00	90.38	

% MH112/MH120/MH120/MH120 c/r(1.0)=0.1
% 0.000	0.000	0.100157	0.103561	0.000049	9.999999	9.999999	0.00	0.01	97.00 	0.00	2000	90.35	1.4503	431.40
% 0.100	0.032	0.109544	0.105565	0.156782	9.999999	9.999999	10.38	30.93	97.00 	6.03	2000	92.10	1.5863	439.75
% 0.200	0.064	0.106447	0.105716	0.313474	6.776597	9.999999	20.14	52.06	95.00 	12.05	2000	92.23	1.5414	440.38
% 0.300	0.095	0.103003	0.105688	0.470236	2.914396	9.967866	29.24	66.26	83.00	18.08	2000	92.21	1.4915	440.26
% 0.400	0.127	0.096224	0.103770	0.629282	1.531446	4.128891	37.09	76.23	80.00	24.10	2000	90.54	1.3934	432.27
% 0.500	0.159	0.090925	0.103893	0.786416	0.926152	2.116497	43.76	82.77	77.00	30.13	2000	90.64	1.3166	432.79
% 0.600	0.191	0.086774	0.101995	0.947186	0.613799	1.202451	51.05	87.11	64.00	36.15	2000	88.99	1.2565	424.88
% 0.700	0.223	0.084195	0.096571	1.117194	0.437551	0.716956	61.03	89.96	35.00	42.17	2000	84.25	1.2192	402.28
% 0.800	0.255	0.079490	0.086326	1.305754	0.316282	0.429352	73.66	92.19	1.00	48.20	2000	75.32	1.1511	359.61
% 0.900	0.286	0.067004	0.078377	1.497631	0.210648	0.273780	76.94	94.40	4.00	54.23	2000	68.38	0.9703	326.49
% 1.000	0.318	0.049108	0.064662	1.729300	0.125053	0.164660	75.95	96.44	7.00	60.25	2000	56.41	0.7111	269.36
% 1.020	0.325	0.045180	0.061215	1.783319	0.110583	0.146891	75.28	96.81	7.00	61.45	2000	53.41	0.6542	255.00
% 1.040	0.331	0.041250	0.057682	1.840033	0.097118	0.130580	74.37	97.16	7.00	62.66	2000	50.32	0.5973	240.28
% 1.060	0.337	0.037066	0.054496	1.896847	0.084005	0.116517	72.10	97.52	10.00	63.86	2000	47.55	0.5367	227.01
% 1.080	0.344	0.033114	0.050781	1.960125	0.072294	0.102652	70.43	97.84	10.00	65.07	2000	44.30	0.4795	211.54
% 1.100	0.350	0.029139	0.046962	2.027889	0.061324	0.089847	68.25	98.14	10.00	66.28	2000	40.97	0.4219	195.63
% 1.120	0.357	0.025137	0.043030	2.101187	0.051028	0.077992	65.43	98.44	10.00	67.48	2000	37.54	0.3640	179.25
% 1.140	0.363	0.021101	0.038979	2.181416	0.041346	0.066997	61.71	98.72	10.00	68.69	2000	34.01	0.3056	162.37
% 1.160	0.369	0.017201	0.035004	2.267961	0.032552	0.057106	57.00	98.98	10.00	69.89	2000	30.54	0.2491	145.81
% 1.180	0.376	0.013222	0.031019	2.363511	0.024182	0.048075	50.30	99.23	10.00	71.10	2000	27.06	0.1915	129.21
% 1.200	0.382	0.008880	0.027421	2.463564	0.015703	0.040409	38.86	99.50	14.00	72.30	2000	23.92	0.1286	114.23
% 1.220	0.388	0.004784	0.023005	2.594141	0.008186	0.032262	25.37	99.73	14.00	73.51	2000	20.07	0.0693	95.83
% 1.240	0.395	0.000689	0.018512	2.753804	0.001142	0.024724	4.62	99.96	14.00	74.71	2000	16.15	0.0100	77.11
% 1.260	0.401	-0.003342	0.014021	2.958124	-0.005360	0.017848	0.00	99.99	14.00	75.92	2000	12.23	-0.0484	58.41
% 1.280	0.407	-0.007313	0.009539	3.245740	-0.011367	0.011582	0.00	99.99	14.00	77.12	2000	8.32	-0.1059	39.73
% 1.300	0.414	-0.011258	0.005026	3.747092	-0.016964	0.005826	0.00	99.99	14.00	78.33	2000	4.39	-0.1630	20.94
% 1.320	0.420	-0.015288	0.000339	6.522834	-0.022343	0.000376	0.00	99.99	14.00	79.53	2000	0.30	-0.2214	1.41
% 1.340	0.427	-0.019763	-0.003554	4.139650	-0.028028	-0.003761	0.38	51.73	18.00	80.74	2000	-3.10	-0.2862	-14.80

% MH112/MH114/MH120/MH120 c/r(1.0)=0.1
0.000	0.000	0.107124	0.105662	0.000049	9.999999	9.999999	0.00	0.01	82.00 	0.00	2000	92.19	1.5512	440.15
0.100	0.032	0.115013	0.106600	0.156476	9.999999	9.999999	10.79	30.30	86.00 	6.03	2000	93.00	1.6655	444.06
0.200	0.064	0.112959	0.107600	0.312369	7.191195	9.999999	21.00	51.03	82.00 	12.05	2000	93.88	1.6357	448.23
0.300	0.095	0.110254	0.108335	0.467915	3.119559	9.999999	30.53	65.07	69.00	18.08	2000	94.52	1.5965	451.29
0.400	0.127	0.103695	0.107118	0.625298	1.650351	4.262100	38.72	75.09	64.00	24.10	2000	93.46	1.5016	446.22
0.500	0.159	0.098360	0.107700	0.780777	1.001886	2.194041	45.66	81.77	59.00	30.13	2000	93.96	1.4243	448.64
0.600	0.191	0.093874	0.106023	0.939878	0.664019	1.249929	53.12	86.28	50.00	36.15	2000	92.50	1.3593	441.66
0.700	0.223	0.090481	0.101531	1.106059	0.470223	0.753780	62.38	89.34	27.00	42.17	2000	88.58	1.3102	422.94
0.800	0.255	0.085119	0.091605	1.290347	0.338676	0.455604	74.34	91.70	1.00	48.20	2000	79.92	1.2326	381.59
0.900	0.286	0.072827	0.083803	1.477713	0.228954	0.292735	78.21	93.96	1.00	54.23	2000	73.11	1.0546	349.10
1.000	0.318	0.055111	0.070514	1.699593	0.140340	0.179562	78.16	96.03	4.00	60.25	2000	61.52	0.7980	293.74
1.020	0.325	0.051290	0.067178	1.750470	0.125538	0.161201	77.88	96.40	4.00	61.45	2000	58.61	0.7427	279.84
1.040	0.331	0.047402	0.063722	1.803744	0.111601	0.144255	77.36	96.76	4.00	62.66	2000	55.59	0.6864	265.45
1.060	0.337	0.043536	0.060166	1.859671	0.098668	0.128638	76.70	97.10	4.00	63.86	2000	52.49	0.6304	250.63
1.080	0.344	0.039651	0.056500	1.918731	0.086566	0.114213	75.79	97.42	4.00	65.07	2000	49.29	0.5742	235.36
1.100	0.350	0.035742	0.052721	1.981508	0.075220	0.100866	74.57	97.73	4.00	66.28	2000	46.00	0.5176	219.62
1.120	0.357	0.031856	0.048881	2.048285	0.064669	0.088598	72.99	98.03	4.00	67.48	2000	42.65	0.4613	203.62
1.140	0.363	0.027226	0.045603	2.114005	0.053348	0.078383	68.06	98.35	7.00	68.69	2000	39.79	0.3943	189.97
1.160	0.369	0.023274	0.041567	2.191330	0.044045	0.067814	64.95	98.63	7.00	69.89	2000	36.27	0.3370	173.16
1.180	0.376	0.019205	0.037520	2.275257	0.035124	0.058150	60.40	98.89	7.00	71.10	2000	32.73	0.2781	156.29
1.200	0.382	0.015186	0.033239	2.370562	0.026854	0.048983	54.82	99.14	7.00	72.30	2000	29.00	0.2199	138.46
1.220	0.388	0.011156	0.028862	2.479106	0.019086	0.040475	47.16	99.38	7.00	73.51	2000	25.18	0.1615	120.23
1.240	0.395	0.007180	0.024472	2.604277	0.011891	0.032685	36.38	99.61	7.00	74.71	2000	21.35	0.1040	101.94
1.260	0.401	0.003175	0.019965	2.756230	0.005092	0.025416	20.03	99.83	7.00	75.92	2000	17.42	0.0460	83.17
1.280	0.407	-0.000861	0.015339	2.951534	-0.001339	0.018626	0.00	99.99	7.00	77.12	2000	13.38	-0.0125	63.90
1.300	0.414	-0.004853	0.010687	3.222341	-0.007313	0.012387	0.00	99.99	7.00	78.33	2000	9.32	-0.0703	44.52
1.320	0.420	-0.009933	0.007290	3.532080	-0.014516	0.008071	0.00	99.99	10.00	79.53	2000	6.36	-0.1438	30.37
1.340	0.427	-0.013955	0.002524	4.432892	-0.019790	0.002671	0.00	99.99	10.00	80.74	2000	2.20	-0.2021	10.51
1.360	0.433	-0.018026	-0.002379	4.552743	-0.024818	-0.002408	0.24	51.59	10.00	81.94	2000	-2.08	-0.2610	-9.91



];

J = V/(n*D);
Ct = interp1(propeller_data(:,1),propeller_data(:,3),J,'linear','extrap');
Cp = interp1(propeller_data(:,1),propeller_data(:,4),J,'linear','extrap');
eta = interp1(propeller_data(:,1),propeller_data(:,8),J,'linear','extrap');
thrust = Ct*rho*n^2*D^4;
power = (Cp*rho*n^3*D^5)/745.7010;

if (plotar==1)
    fig = figure(101);
    subplot(1,3,1)
    plot(propeller_data(:,1),propeller_data(:,3)); hold on; grid on;
    plot(J,Ct,'or','LineWidth',2);
    xlim ([0 1.36]); xlabel('J'),ylabel('C_T');
    subplot(1,3,2)
    plot(propeller_data(:,1),propeller_data(:,4)); hold on; grid on;
    plot(J,Cp,'or','LineWidth',2);
    xlim ([0 1.36]); xlabel('J'),ylabel('C_P');
    subplot(1,3,3)
    plot(propeller_data(:,1),propeller_data(:,8)); hold on; grid on;
    plot(J,eta,'or','LineWidth',2);
    xlim ([0 1.36]); xlabel('J'),ylabel('\eta');
end

end


